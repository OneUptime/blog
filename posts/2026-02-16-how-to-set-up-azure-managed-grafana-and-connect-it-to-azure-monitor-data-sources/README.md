# How to Set Up Azure Managed Grafana and Connect It to Azure Monitor Data Sources

Author: [nawazdhandala](https://www.github.com/nawazdhandala)

Tags: Azure, Managed Grafana, Azure Monitor, Monitoring, Dashboards, Observability, Data Visualization

Description: Step-by-step guide to setting up Azure Managed Grafana and connecting it to Azure Monitor, Log Analytics, and other data sources for unified monitoring.

---

Grafana is one of the most popular open-source platforms for monitoring and observability. Azure Managed Grafana gives you a fully managed Grafana instance that is integrated with Azure Active Directory, automatically connected to Azure Monitor data sources, and maintained by Microsoft so you do not have to worry about infrastructure or upgrades.

In this post, I will walk you through creating an Azure Managed Grafana workspace, connecting it to your Azure data sources, and building your first dashboards.

## Why Azure Managed Grafana?

You might wonder why you would use Managed Grafana instead of just installing Grafana on a VM or running it in a container. There are several practical reasons:

**Azure AD integration.** Users sign in with their Azure AD credentials. No separate Grafana user management needed.

**Automatic data source provisioning.** Azure Monitor data sources (metrics, logs, Azure Resource Graph) are pre-configured. You do not need to set up service accounts or API keys.

**Managed infrastructure.** Microsoft handles the VM, storage, updates, and high availability. You focus on building dashboards.

**Private networking.** You can deploy Managed Grafana with private link for secure access from your corporate network.

**Built-in Azure Monitor integration.** Queries against Azure Monitor and Log Analytics work seamlessly without extra configuration.

## Creating a Managed Grafana Workspace

### Using Azure CLI

```bash
# Create a resource group for your Grafana workspace
az group create \
    --name "grafana-rg" \
    --location "eastus"

# Create the Managed Grafana workspace
az grafana create \
    --name "my-grafana-workspace" \
    --resource-group "grafana-rg" \
    --location "eastus" \
    --sku-tier "Standard"
```

The Standard tier gives you zone redundancy and higher availability. There is also an Essential tier for development and testing at lower cost.

### Using the Azure Portal

Navigate to the Azure Marketplace and search for "Azure Managed Grafana." Click Create and fill in:

- **Subscription and resource group** - Where the Grafana resource will live
- **Instance name** - A unique name for your workspace
- **Region** - Choose a region close to your users
- **Pricing tier** - Standard for production, Essential for dev/test

The creation takes a few minutes. Once complete, you can access the Grafana UI through the endpoint URL shown in the resource overview.

### Using Bicep

For infrastructure as code, here is a Bicep template:

```bicep
// Azure Managed Grafana workspace
resource grafana 'Microsoft.Dashboard/grafana@2023-09-01' = {
  name: 'my-grafana-workspace'
  location: 'eastus'
  sku: {
    // Standard tier for production workloads
    name: 'Standard'
  }
  identity: {
    type: 'SystemAssigned'
  }
  properties: {
    zoneRedundancy: 'Enabled'
    publicNetworkAccess: 'Enabled'
    autoGeneratedDomainNameLabelScope: 'TenantReuse'
    apiKey: 'Enabled'
    deterministicOutboundIP: 'Enabled'
  }
}

// Output the Grafana endpoint URL
output grafanaEndpoint string = grafana.properties.endpoint
```

## Connecting Azure Monitor as a Data Source

When you create a Managed Grafana workspace, Azure Monitor is automatically added as a data source. However, the Grafana workspace needs permissions to read monitoring data from your subscriptions.

### Grant Monitoring Permissions

The Grafana workspace uses a managed identity to access Azure Monitor. You need to assign the Monitoring Reader role to this identity on the subscriptions you want to monitor:

```bash
# Get the managed identity principal ID
GRAFANA_PRINCIPAL_ID=$(az grafana show \
    --name "my-grafana-workspace" \
    --resource-group "grafana-rg" \
    --query "identity.principalId" \
    --output tsv)

# Assign Monitoring Reader role on your subscription
az role assignment create \
    --assignee "$GRAFANA_PRINCIPAL_ID" \
    --role "Monitoring Reader" \
    --scope "/subscriptions/your-subscription-id"

# If you want to query Log Analytics, also add Log Analytics Reader
az role assignment create \
    --assignee "$GRAFANA_PRINCIPAL_ID" \
    --role "Log Analytics Reader" \
    --scope "/subscriptions/your-subscription-id"
```

For multi-subscription monitoring, repeat the role assignment for each subscription.

### Verify the Data Source

Open the Grafana UI (the URL is in the Azure Portal resource overview). Navigate to Configuration and then Data sources. You should see "Azure Monitor" already listed. Click on it to verify the connection.

The Azure Monitor data source in Managed Grafana supports three query types:

1. **Metrics** - Azure resource metrics (CPU, memory, network, etc.)
2. **Logs** - KQL queries against Log Analytics workspaces
3. **Azure Resource Graph** - Resource inventory queries

## Adding Additional Data Sources

### Connecting Prometheus

If you run Prometheus alongside Azure Monitor, you can add it as a data source:

1. In the Grafana UI, go to Configuration > Data sources
2. Click "Add data source"
3. Select "Prometheus"
4. Enter your Prometheus server URL
5. Configure authentication (if needed)
6. Click "Save & Test"

### Connecting Azure Data Explorer

```bash
# Add Azure Data Explorer as a data source using Grafana API
GRAFANA_URL=$(az grafana show \
    --name "my-grafana-workspace" \
    --resource-group "grafana-rg" \
    --query "properties.endpoint" \
    --output tsv)

# Use the Grafana API to add data sources programmatically
az grafana data-source create \
    --name "my-grafana-workspace" \
    --resource-group "grafana-rg" \
    --definition '{
        "name": "Azure Data Explorer",
        "type": "grafana-azure-data-explorer-datasource",
        "access": "proxy",
        "jsonData": {
            "clusterUrl": "https://your-adx-cluster.eastus.kusto.windows.net",
            "azureCredentials": {
                "authType": "msi"
            }
        }
    }'
```

## Building Your First Dashboard

Let me walk through creating a practical infrastructure monitoring dashboard.

### Step 1: Create a New Dashboard

In the Grafana UI, click the "+" icon and select "Dashboard." Then click "Add a new panel."

### Step 2: Add a VM CPU Metric Panel

In the query editor:
- Data source: Azure Monitor
- Service: Metrics
- Resource: Select your virtual machine
- Metric namespace: Virtual Machine Host
- Metric: Percentage CPU
- Aggregation: Average

Set the visualization to "Time series" and give it a title like "VM CPU Usage."

### Step 3: Add a Log Analytics Panel

Add another panel:
- Data source: Azure Monitor
- Service: Logs
- Resource: Select your Log Analytics workspace

Enter this KQL query:

```kusto
// Top 10 error events in the last hour
Event
| where EventLevelName == "Error"
| where TimeGenerated > ago(1h)
| summarize ErrorCount = count() by Source
| top 10 by ErrorCount desc
```

Set the visualization to "Bar chart."

### Step 4: Add an Azure Resource Graph Panel

Add a panel that shows your resource inventory:
- Data source: Azure Monitor
- Service: Azure Resource Graph

```kusto
// Resource count by type
resources
| summarize count() by type
| top 10 by count_ desc
```

## Importing Community Dashboards

The Grafana community has thousands of pre-built dashboards. You can import them directly:

1. Go to grafana.com/grafana/dashboards and find a dashboard
2. Copy the dashboard ID
3. In your Grafana instance, click "+" > "Import"
4. Enter the dashboard ID
5. Select your Azure Monitor data source
6. Click "Import"

Popular dashboards for Azure include:
- Azure Monitor dashboard (ID: 10532)
- Azure VM monitoring (various community dashboards)
- AKS monitoring dashboards

## Configuring Alerting

Managed Grafana supports Grafana's built-in alerting. You can create alerts based on any data source query:

1. Open a dashboard panel
2. Click the "Alert" tab
3. Define your alert condition (e.g., CPU > 90% for 5 minutes)
4. Configure notification channels (email, Teams, PagerDuty, etc.)

### Setting Up a Teams Notification Channel

```
1. In Grafana, go to Alerting > Contact points
2. Click "New contact point"
3. Select "Microsoft Teams" as the integration type
4. Enter your Teams webhook URL
5. Click "Save"
```

## Private Link Configuration

For production environments, you probably want to restrict Grafana access to your corporate network:

```bash
# Disable public access
az grafana update \
    --name "my-grafana-workspace" \
    --resource-group "grafana-rg" \
    --public-network-access "Disabled"

# Create a private endpoint
az network private-endpoint create \
    --name "grafana-pe" \
    --resource-group "grafana-rg" \
    --vnet-name "my-vnet" \
    --subnet "private-endpoints-subnet" \
    --private-connection-resource-id "/subscriptions/sub-id/resourceGroups/grafana-rg/providers/Microsoft.Dashboard/grafana/my-grafana-workspace" \
    --group-id "grafana" \
    --connection-name "grafana-connection"
```

## Backup and Configuration Management

Export your dashboards as JSON for version control:

```bash
# Export all dashboards
az grafana dashboard list \
    --name "my-grafana-workspace" \
    --resource-group "grafana-rg" \
    --output json > dashboards-list.json

# Export a specific dashboard
az grafana dashboard show \
    --name "my-grafana-workspace" \
    --resource-group "grafana-rg" \
    --dashboard "dashboard-uid" \
    --output json > my-dashboard.json

# Import a dashboard from JSON
az grafana dashboard import \
    --name "my-grafana-workspace" \
    --resource-group "grafana-rg" \
    --definition @my-dashboard.json
```

## Best Practices

**Use the Standard tier for production.** It provides zone redundancy and better SLAs.

**Grant least-privilege access.** Only assign Monitoring Reader where needed, not on the entire tenant.

**Export dashboards to version control.** Treat dashboards as code and store them in Git.

**Use variables in dashboards.** Dashboard variables let users filter by subscription, resource group, or time range without editing the query.

**Set up alerting from day one.** Do not just build pretty dashboards - make them actionable with alerts.

## Summary

Azure Managed Grafana gives you a production-ready Grafana instance with deep Azure integration. The automatic Azure Monitor data source, Azure AD authentication, and managed infrastructure mean you can go from zero to monitoring dashboards in under an hour. Start with the built-in Azure Monitor data source, build a few key dashboards, import community dashboards for common scenarios, and expand from there.
