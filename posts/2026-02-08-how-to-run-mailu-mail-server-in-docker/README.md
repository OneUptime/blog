# How to Run Mailu Mail Server in Docker

Author: [nawazdhandala](https://github.com/nawazdhandala)

Tags: Docker, Mailu, Mail Server, Email, SMTP, IMAP, Self-Hosted, Containers, Postfix, Dovecot

Description: Deploy Mailu, a full-featured self-hosted mail server, in Docker with SMTP, IMAP, webmail, antispam, antivirus, and automatic TLS certificate management.

---

Mailu is a complete mail server solution designed to run in Docker containers. It bundles together all the components you need for a production mail server: Postfix for SMTP, Dovecot for IMAP, Rspamd for spam filtering, ClamAV for antivirus scanning, a webmail client, and an admin interface. The entire stack is configured to work together out of the box, which eliminates the weeks of manual configuration that a traditional mail server setup requires.

Self-hosting email is one of the most complex server administration tasks. Mailu makes it manageable by packaging tested, pre-configured components into Docker containers. This guide walks through the setup from DNS configuration to a fully working mail server.

## Prerequisites

You need:

- A server with a public IP address (not behind NAT)
- Docker Engine 20.10+
- Docker Compose v2
- A domain name with full DNS control
- At least 2GB of RAM (4GB with ClamAV enabled)
- Ports 25, 143, 465, 587, 993, 80, and 443 available

```bash
# Verify Docker
docker --version
docker compose version

# Verify that port 25 is not blocked (many cloud providers block it)
telnet smtp.gmail.com 25
```

Important: Many cloud providers (AWS, GCP, Azure) block outbound port 25 by default. You may need to request an exception or use a different hosting provider.

## DNS Configuration

Proper DNS records are essential for email deliverability. Set these up before deploying Mailu.

```
# Required DNS records for mail.yourdomain.com

# A record pointing to your server
mail.yourdomain.com.        A       YOUR_SERVER_IP

# MX record directing email to your server
yourdomain.com.             MX  10  mail.yourdomain.com.

# SPF record authorizing your server to send email
yourdomain.com.             TXT     "v=spf1 mx a:mail.yourdomain.com ~all"

# DMARC record for email authentication policy
_dmarc.yourdomain.com.      TXT     "v=DMARC1; p=quarantine; rua=mailto:postmaster@yourdomain.com"

# Reverse DNS (PTR record) - set this in your hosting provider's control panel
YOUR_SERVER_IP              PTR     mail.yourdomain.com

# Autoconfig for email clients (optional but helpful)
autoconfig.yourdomain.com.  CNAME   mail.yourdomain.com.
autodiscover.yourdomain.com. CNAME  mail.yourdomain.com.
```

The DKIM record will be generated by Mailu after the first startup. You will add it later.

## Using the Mailu Configuration Generator

Mailu provides an online configuration generator at `https://setup.mailu.io`. It creates Docker Compose and environment files based on your answers. However, you can also set things up manually.

## Manual Docker Compose Configuration

```yaml
# docker-compose.yml - Mailu complete mail server
version: "3.8"

services:
  # Front-end reverse proxy handling TLS and routing
  front:
    image: mailu/nginx:2024.06
    container_name: mailu-front
    ports:
      - "80:80"       # HTTP (for Let's Encrypt challenges)
      - "443:443"     # HTTPS (webmail and admin)
      - "25:25"       # SMTP
      - "465:465"     # SMTP over TLS
      - "587:587"     # SMTP submission
      - "143:143"     # IMAP
      - "993:993"     # IMAP over TLS
      - "110:110"     # POP3
      - "995:995"     # POP3 over TLS
    volumes:
      - mailu-certs:/certs
      - mailu-overrides:/overrides:ro
    environment:
      - LOG_LEVEL=WARNING
    env_file:
      - .env
    depends_on:
      - resolver
    networks:
      default:
      webmail:
    restart: unless-stopped

  # DNS resolver for internal service discovery
  resolver:
    image: mailu/unbound:2024.06
    container_name: mailu-resolver
    env_file:
      - .env
    networks:
      default:
        ipv4_address: 192.168.203.254
    restart: unless-stopped

  # Admin interface for managing domains, users, and aliases
  admin:
    image: mailu/admin:2024.06
    container_name: mailu-admin
    volumes:
      - mailu-data:/data
      - mailu-dkim:/dkim
    env_file:
      - .env
    depends_on:
      - redis
      - resolver
    networks:
      - default
    restart: unless-stopped

  # IMAP server (Dovecot) for email retrieval
  imap:
    image: mailu/dovecot:2024.06
    container_name: mailu-imap
    volumes:
      - mailu-mail:/mail
      - mailu-overrides:/overrides:ro
    env_file:
      - .env
    depends_on:
      - front
      - resolver
    networks:
      - default
    restart: unless-stopped

  # SMTP server (Postfix) for sending and receiving email
  smtp:
    image: mailu/postfix:2024.06
    container_name: mailu-smtp
    volumes:
      - mailu-mailqueue:/queue
      - mailu-overrides:/overrides:ro
    env_file:
      - .env
    depends_on:
      - front
      - resolver
    networks:
      - default
    restart: unless-stopped

  # Antispam filter (Rspamd)
  antispam:
    image: mailu/rspamd:2024.06
    container_name: mailu-antispam
    volumes:
      - mailu-filter:/var/lib/rspamd
      - mailu-overrides:/overrides:ro
    env_file:
      - .env
    depends_on:
      - front
      - resolver
    networks:
      - default
    restart: unless-stopped

  # Webmail client (Roundcube)
  webmail:
    image: mailu/roundcube:2024.06
    container_name: mailu-webmail
    volumes:
      - mailu-webmail-data:/data
      - mailu-overrides:/overrides:ro
    env_file:
      - .env
    depends_on:
      - front
      - resolver
    networks:
      - webmail
    restart: unless-stopped

  # Redis for session storage and caching
  redis:
    image: redis:7-alpine
    container_name: mailu-redis
    volumes:
      - mailu-redis:/data
    depends_on:
      - resolver
    networks:
      - default
    restart: unless-stopped

volumes:
  mailu-certs:
  mailu-data:
  mailu-dkim:
  mailu-mail:
  mailu-mailqueue:
  mailu-filter:
  mailu-webmail-data:
  mailu-redis:
  mailu-overrides:

networks:
  default:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.203.0/24
  webmail:
    driver: bridge
```

## Environment Configuration

Create the `.env` file with your server settings.

```bash
# .env - Mailu environment configuration

# Domain and hostname
DOMAIN=yourdomain.com
HOSTNAMES=mail.yourdomain.com

# Postmaster address
POSTMASTER=admin

# Secret key for session encryption (generate a random one)
SECRET_KEY=ChangeMeToARandomStringAtLeast16CharactersLong

# Subnet used by Docker for Mailu containers
SUBNET=192.168.203.0/24

# TLS configuration
# Options: letsencrypt, cert, notls, mail, mail-letsencrypt
TLS_FLAVOR=letsencrypt

# Authentication settings
AUTH_RATELIMIT_IP=60/hour
AUTH_RATELIMIT_USER=100/day

# Admin interface
# Set to true only for the first run to create the admin user
INITIAL_ADMIN_ACCOUNT=admin
INITIAL_ADMIN_DOMAIN=yourdomain.com
INITIAL_ADMIN_PW=changeme123

# Optional features
DISABLE_STATISTICS=False

# Webmail choice: roundcube, snappymail, or none
WEBMAIL=roundcube

# Antivirus: clamav or none (clamav needs 2GB+ extra RAM)
ANTIVIRUS=none

# Message size limit (50MB)
MESSAGE_SIZE_LIMIT=50000000

# Welcome email toggle
WELCOME=true
WELCOME_SUBJECT=Welcome to our mail server
WELCOME_BODY=Welcome to our self-hosted email!

# Compose project name
COMPOSE_PROJECT_NAME=mailu
```

## Starting the Stack

```bash
# Start all Mailu services
docker compose up -d

# Watch the startup process
docker compose logs -f

# Check that all containers are healthy
docker compose ps
```

The first startup takes a few minutes. If you chose `letsencrypt` for TLS, Mailu automatically obtains and renews certificates.

## Setting Up the DKIM Record

After the first startup, Mailu generates DKIM keys. Retrieve the DNS record you need to add.

```bash
# Get the DKIM public key
docker compose exec admin cat /dkim/yourdomain.com.dkim.key

# Or check the admin interface at:
# https://mail.yourdomain.com/admin/domain/details/yourdomain.com
```

Add the DKIM TXT record to your DNS.

```
dkim._domainkey.yourdomain.com.  TXT  "v=DKIM1; k=rsa; p=YOUR_PUBLIC_KEY_HERE"
```

## Accessing the Admin Interface

Open `https://mail.yourdomain.com/admin/` in your browser. Log in with the initial admin credentials from your `.env` file.

From the admin panel, you can:

- Add domains
- Create email accounts
- Set up aliases and forwards
- Configure domain-level settings
- View logs and statistics

## Creating Email Accounts

```bash
# Create accounts through the admin web interface
# Or use the CLI
docker compose exec admin flask mailu user myuser yourdomain.com 'password123'
```

## Accessing Webmail

Roundcube webmail is available at `https://mail.yourdomain.com/webmail/`. Users log in with their full email address and password.

## Configuring Email Clients

For desktop and mobile email clients, use these settings.

| Setting | Value |
|---------|-------|
| IMAP Server | mail.yourdomain.com |
| IMAP Port | 993 (TLS) or 143 (STARTTLS) |
| SMTP Server | mail.yourdomain.com |
| SMTP Port | 465 (TLS) or 587 (STARTTLS) |
| Username | Full email address |
| Authentication | Normal password |

## Testing Email Deliverability

After setup, test your email configuration.

```bash
# Test sending an email
docker compose exec smtp postfix status

# Check your mail server's reputation and configuration
# Use these online tools:
# - mail-tester.com (send an email to the provided address)
# - mxtoolbox.com (check DNS records)
# - dkimvalidator.com (verify DKIM signing)
```

## Backup and Restore

```bash
# Back up all Mailu data
docker compose down
docker run --rm -v mailu_mailu-mail:/data -v $(pwd):/backup alpine tar czf /backup/mailu-mail-$(date +%Y%m%d).tar.gz /data
docker run --rm -v mailu_mailu-data:/data -v $(pwd):/backup alpine tar czf /backup/mailu-data-$(date +%Y%m%d).tar.gz /data
docker compose up -d

# Restore from backup
docker compose down
docker run --rm -v mailu_mailu-mail:/data -v $(pwd):/backup alpine tar xzf /backup/mailu-mail-20260201.tar.gz -C /
docker compose up -d
```

## Stopping and Cleaning Up

```bash
# Stop all services
docker compose down

# Remove everything including all email data
docker compose down -v
```

## Summary

Mailu provides a complete, production-ready mail server in Docker containers. The stack includes SMTP, IMAP, webmail, spam filtering, and an admin interface, all pre-configured to work together. The hardest part of self-hosting email is not the software setup but the DNS configuration and IP reputation management. Mailu handles the software side cleanly, leaving you to focus on DNS records, deliverability testing, and ongoing maintenance. With automatic TLS certificate management and built-in spam filtering, Mailu is one of the most accessible ways to self-host email.
