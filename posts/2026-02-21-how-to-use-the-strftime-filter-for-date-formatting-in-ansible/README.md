# How to Use the strftime Filter for Date Formatting in Ansible

Author: [nawazdhandala](https://www.github.com/nawazdhandala)

Tags: Ansible, Filters, Date Formatting, Templates, Automation

Description: Learn how to use the strftime filter in Ansible to format dates and timestamps for log files, backup names, and configuration headers.

---

Timestamps show up everywhere in infrastructure automation. Backup file names need dates, log entries need timestamps, configuration files need generation dates, and reports need formatted time strings. The `strftime` filter in Ansible formats Unix timestamps into human-readable date strings using Python's strftime format codes.

## Basic Usage

The strftime filter takes a format string and an optional Unix timestamp. If no timestamp is provided, it uses the current time:

```yaml
# Format the current time in various formats
- name: Show current date and time
  ansible.builtin.debug:
    msg: |
      ISO format:    {{ '%Y-%m-%dT%H:%M:%S' | strftime }}
      Date only:     {{ '%Y-%m-%d' | strftime }}
      Time only:     {{ '%H:%M:%S' | strftime }}
      US format:     {{ '%m/%d/%Y' | strftime }}
      Readable:      {{ '%B %d, %Y at %I:%M %p' | strftime }}
      Compact:       {{ '%Y%m%d_%H%M%S' | strftime }}
```

Output (example):
```
ISO format:    2026-02-21T14:30:45
Date only:     2026-02-21
Time only:     14:30:45
US format:     02/21/2026
Readable:      February 21, 2026 at 02:30 PM
Compact:       20260221_143045
```

## Formatting a Specific Timestamp

When you have a Unix epoch timestamp, pass it as an argument:

```yaml
# Format a specific Unix timestamp
- name: Format specific timestamp
  ansible.builtin.debug:
    msg: "File was modified: {{ '%Y-%m-%d %H:%M:%S' | strftime(file_stat.stat.mtime) }}"
  vars:
    file_stat:
      stat:
        mtime: 1708531200
```

## Common Format Codes

Here is a quick reference for the format codes you will use most often:

```yaml
# Common strftime format codes with examples
- name: Format code reference
  ansible.builtin.debug:
    msg: |
      %Y = 4-digit year:     {{ '%Y' | strftime }}
      %m = month (01-12):    {{ '%m' | strftime }}
      %d = day (01-31):      {{ '%d' | strftime }}
      %H = hour 24h (00-23): {{ '%H' | strftime }}
      %I = hour 12h (01-12): {{ '%I' | strftime }}
      %M = minute (00-59):   {{ '%M' | strftime }}
      %S = second (00-59):   {{ '%S' | strftime }}
      %p = AM/PM:            {{ '%p' | strftime }}
      %A = weekday name:     {{ '%A' | strftime }}
      %B = month name:       {{ '%B' | strftime }}
      %Z = timezone:         {{ '%Z' | strftime }}
      %j = day of year:      {{ '%j' | strftime }}
      %U = week number:      {{ '%U' | strftime }}
```

## Practical Example: Backup File Naming

One of the most common uses is generating timestamped backup filenames:

```yaml
# Create a database backup with a timestamped filename
- name: Set backup filename
  ansible.builtin.set_fact:
    backup_filename: "db_backup_{{ '%Y%m%d_%H%M%S' | strftime }}.sql.gz"

- name: Create database backup
  ansible.builtin.shell: |
    pg_dump mydb | gzip > /var/backups/{{ backup_filename }}
  register: backup_result

- name: Record backup in log
  ansible.builtin.lineinfile:
    path: /var/log/backups.log
    line: "{{ '%Y-%m-%d %H:%M:%S' | strftime }} - Created {{ backup_filename }} - {{ 'SUCCESS' if backup_result.rc == 0 else 'FAILED' }}"
    create: true
```

## Log Rotation with Date-Based Names

```yaml
# Rotate application logs with date-stamped archives
- name: Rotate logs
  ansible.builtin.shell: |
    mv /var/log/myapp/app.log /var/log/myapp/app.log.{{ '%Y%m%d' | strftime }}
  when: log_stat.stat.size > 104857600  # > 100MB

- name: Compress old logs
  ansible.builtin.shell: |
    gzip /var/log/myapp/app.log.{{ '%Y%m%d' | strftime }}
```

## Configuration File Headers

Adding generation timestamps to managed configuration files:

```jinja2
{# templates/nginx.conf.j2 - Config with generation timestamp #}
# Nginx Configuration
# Generated by Ansible on {{ '%Y-%m-%d at %H:%M:%S %Z' | strftime }}
# Do not edit manually - changes will be overwritten
# Host: {{ inventory_hostname }}

worker_processes auto;
events {
    worker_connections 1024;
}

http {
    # Server configuration
    server {
        listen 80;
        server_name {{ server_name }};
        root {{ document_root }};
    }
}
```

## Generating Date-Based Directory Structures

```yaml
# Create a date-based directory structure for deployments
- name: Set deployment paths
  ansible.builtin.set_fact:
    deploy_date: "{{ '%Y-%m-%d' | strftime }}"
    deploy_timestamp: "{{ '%Y%m%d%H%M%S' | strftime }}"

- name: Create deployment directory
  ansible.builtin.file:
    path: "/opt/deploys/{{ deploy_date }}/{{ deploy_timestamp }}"
    state: directory
    mode: '0755'

- name: Deploy application
  ansible.builtin.copy:
    src: "{{ app_artifact }}"
    dest: "/opt/deploys/{{ deploy_date }}/{{ deploy_timestamp }}/app.jar"

- name: Update symlink to current deployment
  ansible.builtin.file:
    src: "/opt/deploys/{{ deploy_date }}/{{ deploy_timestamp }}"
    dest: /opt/app/current
    state: link
```

## Deployment Reports

Generate reports with formatted timestamps:

```jinja2
{# templates/deploy_report.html.j2 - Deployment report with timestamps #}
<!DOCTYPE html>
<html>
<head><title>Deployment Report</title></head>
<body>
<h1>Deployment Report</h1>
<table>
<tr><th>Field</th><th>Value</th></tr>
<tr><td>Application</td><td>{{ app_name }}</td></tr>
<tr><td>Version</td><td>{{ app_version }}</td></tr>
<tr><td>Deployed At</td><td>{{ '%B %d, %Y at %I:%M %p %Z' | strftime }}</td></tr>
<tr><td>Deployed By</td><td>{{ ansible_user_id }}</td></tr>
<tr><td>Target Host</td><td>{{ inventory_hostname }}</td></tr>
</table>

<h2>Deployment History</h2>
<ul>
{% for deploy in deployment_history %}
<li>{{ '%Y-%m-%d %H:%M' | strftime(deploy.timestamp) }} - v{{ deploy.version }} by {{ deploy.user }}</li>
{% endfor %}
</ul>
</body>
</html>
```

## Cleanup Tasks Based on Date

Use strftime to calculate date thresholds for cleanup:

```yaml
# Clean up backups older than 30 days
- name: Calculate cutoff date
  ansible.builtin.set_fact:
    cutoff_date: "{{ '%Y%m%d' | strftime(ansible_date_time.epoch | int - 2592000) }}"

- name: Find old backup files
  ansible.builtin.find:
    paths: /var/backups
    patterns: "db_backup_*.sql.gz"
    age: 30d
  register: old_backups

- name: Remove old backups
  ansible.builtin.file:
    path: "{{ item.path }}"
    state: absent
  loop: "{{ old_backups.files }}"
  loop_control:
    label: "{{ item.path | basename }}"
```

## Using strftime with ansible_date_time

Ansible provides the `ansible_date_time` fact, which already has many formatted fields. But strftime gives you more control:

```yaml
# Compare ansible_date_time with custom strftime formatting
- name: Date formatting options
  ansible.builtin.debug:
    msg: |
      Built-in fact: {{ ansible_date_time.iso8601 }}
      Custom format: {{ '%Y-%m-%dT%H:%M:%S%z' | strftime }}

      Built-in date: {{ ansible_date_time.date }}
      Custom date:   {{ '%A, %B %d, %Y' | strftime }}

      Epoch: {{ ansible_date_time.epoch }}
      From epoch: {{ '%Y-%m-%d' | strftime(ansible_date_time.epoch) }}
```

## Timezone Considerations

By default, strftime uses the system's local timezone. Keep this in mind when running playbooks across hosts in different timezones:

```yaml
# Show timezone information
- name: Display timezone info
  ansible.builtin.debug:
    msg: |
      Local time: {{ '%Y-%m-%d %H:%M:%S %Z' | strftime }}
      UTC offset: {{ '%z' | strftime }}
```

If you need consistent UTC timestamps across all hosts, use `ansible_date_time.epoch` as the base and handle timezone conversion in your template logic.

## Cron Job Comments

Add readable timestamps to cron jobs:

```yaml
# Install a cron job with a timestamp comment
- name: Schedule backup job
  ansible.builtin.cron:
    name: "Database backup (installed {{ '%Y-%m-%d' | strftime }})"
    minute: "0"
    hour: "2"
    job: "/usr/local/bin/backup.sh >> /var/log/backup.log 2>&1"
```

## Summary

The `strftime` filter is your go-to for formatting timestamps in Ansible. Use it for backup filenames (`%Y%m%d_%H%M%S`), configuration headers (`%Y-%m-%d at %H:%M:%S`), deployment reports (`%B %d, %Y`), and log entries (`%Y-%m-%d %H:%M:%S`). Remember that it uses the local timezone by default, accepts Unix epoch timestamps as optional input, and follows Python's strftime format codes. For consistent cross-host timestamps, work with epoch values and format them at the point of output.
